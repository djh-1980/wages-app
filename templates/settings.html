{% extends "base.html" %}

{% block title %}Settings - TVS App{% endblock %}

{% block content %}
<h2 class="mb-4">
    <i class="bi bi-gear"></i> Settings
</h2>

<div class="row g-4">
    <!-- Data Management -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="bi bi-database text-primary"></i> Data Management
                </h5>
                <p class="card-text text-muted">Manage your payslips and run sheets data.</p>
                
                <div class="list-group list-group-flush">
                    <a href="#" class="list-group-item list-group-item-action" onclick="syncPayslips(); return false;">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <i class="bi bi-arrow-repeat text-primary"></i>
                                <strong>Sync Payslips</strong>
                                <br>
                                <small class="text-muted">Import new payslips from folder</small>
                            </div>
                            <i class="bi bi-chevron-right"></i>
                        </div>
                    </a>
                    
                    <a href="#" class="list-group-item list-group-item-action" onclick="syncRunSheets(); return false;">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <i class="bi bi-arrow-repeat text-success"></i>
                                <strong>Sync Run Sheets</strong>
                                <br>
                                <small class="text-muted">Import new run sheets from folder</small>
                            </div>
                            <i class="bi bi-chevron-right"></i>
                        </div>
                    </a>
                    
                    <a href="#" class="list-group-item list-group-item-action" onclick="downloadFromGmail(); return false;">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <i class="bi bi-envelope text-info"></i>
                                <strong>Download from Gmail</strong>
                                <br>
                                <small class="text-muted">Fetch latest run sheets from email</small>
                            </div>
                            <i class="bi bi-chevron-right"></i>
                        </div>
                    </a>
                    
                    <a href="#" class="list-group-item list-group-item-action" onclick="validateData(); return false;">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <i class="bi bi-check-circle text-success"></i>
                                <strong>Validate Data</strong>
                                <br>
                                <small class="text-muted">Check data integrity and completeness</small>
                            </div>
                            <i class="bi bi-chevron-right"></i>
                        </div>
                    </a>
                </div>
            </div>
        </div>
    </div>

    <!-- Application Settings -->
    <div class="col-md-6">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="bi bi-sliders text-success"></i> Application Settings
                </h5>
                <p class="card-text text-muted">Configure application preferences.</p>
                
                <div class="mb-3">
                    <label class="form-label">Default Page</label>
                    <select class="form-select" id="defaultPage">
                        <option value="runsheets" selected>Run Sheets</option>
                        <option value="wages">Wages</option>
                        <option value="reports">Reporting</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Items Per Page</label>
                    <select class="form-select" id="itemsPerPage">
                        <option value="10">10</option>
                        <option value="20" selected>20</option>
                        <option value="50">50</option>
                        <option value="100">100</option>
                    </select>
                </div>
                
                <div class="mb-3">
                    <label class="form-label">Date Format</label>
                    <select class="form-select" id="dateFormat">
                        <option value="DD/MM/YYYY" selected>DD/MM/YYYY</option>
                        <option value="MM/DD/YYYY">MM/DD/YYYY</option>
                        <option value="YYYY-MM-DD">YYYY-MM-DD</option>
                    </select>
                </div>
                
                <button class="btn btn-primary" onclick="saveSettings()">
                    <i class="bi bi-save"></i> Save Settings
                </button>
            </div>
        </div>
    </div>
</div>

<!-- Database Info -->
<div class="row mt-4">
    <div class="col-12">
        <div class="card">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="bi bi-info-circle text-info"></i> Database Information
                </h5>
                
                <div class="row">
                    <div class="col-md-3">
                        <div class="text-center p-3">
                            <h4 class="text-primary" id="dbPayslips">-</h4>
                            <small class="text-muted">Payslips</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center p-3">
                            <h4 class="text-success" id="dbRunSheets">-</h4>
                            <small class="text-muted">Run Sheet Days</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center p-3">
                            <h4 class="text-info" id="dbJobs">-</h4>
                            <small class="text-muted">Total Jobs</small>
                        </div>
                    </div>
                    <div class="col-md-3">
                        <div class="text-center p-3">
                            <h4 class="text-warning" id="dbSize">-</h4>
                            <small class="text-muted">Database Size</small>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Status Messages -->
<div id="settingsStatus" class="mt-4" style="display: none;">
    <div class="alert alert-info">
        <i class="bi bi-hourglass-split"></i> Processing...
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
    // Load database info on page load
    document.addEventListener('DOMContentLoaded', function() {
        loadDatabaseInfo();
    });
    
    function loadDatabaseInfo() {
        // Load payslips count
        fetch('/api/summary')
            .then(response => response.json())
            .then(data => {
                document.getElementById('dbPayslips').textContent = data.total_weeks || 0;
            });
        
        // Load run sheets count
        fetch('/api/runsheets/summary')
            .then(response => response.json())
            .then(data => {
                document.getElementById('dbRunSheets').textContent = data.overall.total_days || 0;
                document.getElementById('dbJobs').textContent = data.overall.total_jobs || 0;
            });
        
        // Database size (mock for now)
        document.getElementById('dbSize').textContent = '~5 MB';
    }
    
    function syncPayslips() {
        showStatus('Syncing payslips...');
        alert('Payslip sync - Coming soon!');
    }
    
    function syncRunSheets() {
        showStatus('Syncing run sheets...');
        alert('Run sheets sync - Coming soon!');
    }
    
    function downloadFromGmail() {
        showStatus('Downloading from Gmail...');
        alert('Gmail download - Coming soon!\nUse: python3 scripts/download_runsheets_gmail.py');
    }
    
    function validateData() {
        showStatus('Validating data...');
        alert('Data validation - Coming soon!\nUse: python3 scripts/validate_runsheets.py');
    }
    
    function saveSettings() {
        const defaultPage = document.getElementById('defaultPage').value;
        const itemsPerPage = document.getElementById('itemsPerPage').value;
        const dateFormat = document.getElementById('dateFormat').value;
        
        // Save to localStorage
        localStorage.setItem('defaultPage', defaultPage);
        localStorage.setItem('itemsPerPage', itemsPerPage);
        localStorage.setItem('dateFormat', dateFormat);
        
        showSuccess('Settings saved successfully!');
    }
    
    function showStatus(message) {
        const status = document.getElementById('settingsStatus');
        status.innerHTML = `<div class="alert alert-info"><i class="bi bi-hourglass-split"></i> ${message}</div>`;
        status.style.display = 'block';
    }
    
    function showSuccess(message) {
        const status = document.getElementById('settingsStatus');
        status.innerHTML = `<div class="alert alert-success"><i class="bi bi-check-circle"></i> ${message}</div>`;
        status.style.display = 'block';
        setTimeout(() => status.style.display = 'none', 3000);
    }
    
    function showError(message) {
        const status = document.getElementById('settingsStatus');
        status.innerHTML = `<div class="alert alert-danger"><i class="bi bi-x-circle"></i> ${message}</div>`;
        status.style.display = 'block';
    }
</script>
{% endblock %}
