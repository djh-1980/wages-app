<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Wages App - Payslip Dashboard</title>
    
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Bootstrap Icons -->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.0/font/bootstrap-icons.css">
    <!-- Chart.js -->
    <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.0/dist/chart.umd.min.js"></script>
    
    <style>
        :root {
            --primary-color: #0d6efd;
            --success-color: #198754;
            --info-color: #0dcaf0;
            --warning-color: #ffc107;
        }
        
        body {
            background-color: #f8f9fa;
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
        }
        
        .navbar {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }
        
        .stat-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
            transition: transform 0.2s, box-shadow 0.2s;
            height: 100%;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 15px rgba(0,0,0,0.1);
        }
        
        .stat-icon {
            width: 60px;
            height: 60px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 28px;
        }
        
        .chart-container {
            position: relative;
            height: 350px;
        }
        
        .table-card {
            border: none;
            border-radius: 15px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.07);
        }
        
        .badge-custom {
            padding: 0.5rem 1rem;
            border-radius: 20px;
            font-weight: 500;
        }
        
        .search-box {
            border-radius: 25px;
            border: 2px solid #e9ecef;
            padding: 0.75rem 1.5rem;
            transition: border-color 0.3s;
        }
        
        .search-box:focus {
            border-color: #667eea;
            box-shadow: 0 0 0 0.2rem rgba(102, 126, 234, 0.25);
        }
        
        .loading {
            display: none;
            text-align: center;
            padding: 2rem;
        }
        
        .spinner-border-custom {
            width: 3rem;
            height: 3rem;
        }
        
        .bg-gradient-primary {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .bg-gradient-success {
            background: linear-gradient(135deg, #84fab0 0%, #8fd3f4 100%);
        }
        
        .bg-gradient-info {
            background: linear-gradient(135deg, #a1c4fd 0%, #c2e9fb 100%);
        }
        
        .bg-gradient-warning {
            background: linear-gradient(135deg, #ffecd2 0%, #fcb69f 100%);
        }
        
        .section-title {
            font-weight: 600;
            color: #2d3748;
            margin-bottom: 1.5rem;
        }
        
        .tab-content {
            padding-top: 2rem;
        }
        
        .nav-pills .nav-link {
            border-radius: 10px;
            font-weight: 500;
            transition: all 0.3s;
        }
        
        .nav-pills .nav-link.active {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        /* Mobile & Tablet Optimizations */
        @media (max-width: 768px) {
            .container-fluid {
                padding-left: 0.5rem !important;
                padding-right: 0.5rem !important;
            }
            
            .navbar {
                padding: 0.5rem 1rem;
            }
            
            .navbar-brand {
                font-size: 0.9rem;
            }
            
            .navbar-brand i {
                font-size: 1.2rem;
            }
            
            #currentDate {
                font-size: 0.75rem;
            }
            
            /* Summary cards - stack vertically */
            .row.g-4 {
                gap: 0.75rem !important;
            }
            
            .stat-card {
                margin-bottom: 0;
            }
            
            .stat-icon {
                width: 45px;
                height: 45px;
                font-size: 20px;
            }
            
            .stat-card h3 {
                font-size: 1.25rem;
            }
            
            .stat-card small {
                font-size: 0.7rem;
            }
            
            .stat-card p {
                font-size: 0.75rem;
            }
            
            .chart-container {
                height: 250px;
                margin-bottom: 1rem;
            }
            
            .table-responsive {
                font-size: 0.8rem;
            }
            
            .table th, .table td {
                padding: 0.5rem 0.25rem;
            }
            
            /* Navigation tabs - horizontal scroll */
            .nav-pills {
                flex-wrap: nowrap;
                overflow-x: auto;
                -webkit-overflow-scrolling: touch;
                margin-bottom: 1rem;
                padding-bottom: 0.5rem;
            }
            
            .nav-pills::-webkit-scrollbar {
                height: 4px;
            }
            
            .nav-pills::-webkit-scrollbar-thumb {
                background: #667eea;
                border-radius: 4px;
            }
            
            .nav-pills .nav-link {
                white-space: nowrap;
                font-size: 0.85rem;
                padding: 0.5rem 0.75rem;
                margin-right: 0.5rem;
            }
            
            .card-body {
                padding: 0.75rem;
            }
            
            .card-header {
                padding: 0.75rem;
            }
            
            .btn-sm {
                font-size: 0.75rem;
                padding: 0.35rem 0.6rem;
            }
            
            /* Hide less important columns on mobile */
            .hide-mobile {
                display: none !important;
            }
            
            /* Stack filters vertically on mobile */
            .filter-row .col-md-3,
            .filter-row .col-md-2,
            .filter-row .col-md-4 {
                margin-bottom: 0.5rem;
            }
            
            /* Make badges smaller */
            .badge {
                font-size: 0.7rem;
                padding: 0.25rem 0.5rem;
            }
            
            /* Section titles */
            .section-title {
                font-size: 1.1rem;
            }
        }
        
        @media (min-width: 769px) and (max-width: 1024px) {
            /* Tablet specific styles */
            .container-fluid {
                padding-left: 2rem !important;
                padding-right: 2rem !important;
            }
            
            .chart-container {
                height: 300px;
            }
            
            .stat-card h3 {
                font-size: 1.75rem;
            }
        }
        
        /* Touch-friendly buttons */
        @media (hover: none) {
            .btn {
                min-height: 44px;
            }
            
            .stat-card:hover {
                transform: none;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <nav class="navbar navbar-dark mb-4">
        <div class="container-fluid">
            <a class="navbar-brand" href="#">
                <i class="bi bi-wallet2"></i>
                <strong>Wages App</strong>
            </a>
            <div class="d-flex align-items-center text-white">
                <i class="bi bi-calendar3 me-2"></i>
                <span id="currentDate"></span>
            </div>
        </div>
    </nav>

    <div class="container-fluid px-4">
        <!-- Summary Cards -->
        <div class="row g-4 mb-4" id="summaryCards">
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <p class="text-muted mb-1 small">Total Earnings</p>
                                <h3 class="mb-0" id="totalEarnings">£0.00</h3>
                                <small class="text-success"><i class="bi bi-arrow-up"></i> All time</small>
                            </div>
                            <div class="stat-icon bg-gradient-primary text-white">
                                <i class="bi bi-currency-pound"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <p class="text-muted mb-1 small">Average Weekly</p>
                                <h3 class="mb-0" id="avgWeekly">£0.00</h3>
                                <small class="text-info"><i class="bi bi-graph-up"></i> Per week</small>
                            </div>
                            <div class="stat-icon bg-gradient-success text-white">
                                <i class="bi bi-bar-chart-line"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <p class="text-muted mb-1 small">Total Jobs</p>
                                <h3 class="mb-0" id="totalJobs">0</h3>
                                <small class="text-warning"><i class="bi bi-briefcase"></i> Completed</small>
                            </div>
                            <div class="stat-icon bg-gradient-info text-white">
                                <i class="bi bi-briefcase-fill"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
            
            <div class="col-md-3">
                <div class="card stat-card">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-center">
                            <div>
                                <p class="text-muted mb-1 small">Best Week</p>
                                <h3 class="mb-0" id="bestWeek">£0.00</h3>
                                <small class="text-danger"><i class="bi bi-trophy"></i> <span id="bestWeekInfo"></span></small>
                            </div>
                            <div class="stat-icon bg-gradient-warning text-white">
                                <i class="bi bi-trophy-fill"></i>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content Tabs -->
        <div class="row">
            <div class="col-12">
                <div class="card table-card">
                    <div class="card-body">
                        <ul class="nav nav-pills mb-3" id="mainTabs" role="tablist">
                            <li class="nav-item" role="presentation">
                                <button class="nav-link active" id="dashboard-tab" data-bs-toggle="pill" data-bs-target="#dashboard" type="button">
                                    <i class="bi bi-speedometer2"></i> Dashboard
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="payslips-tab" data-bs-toggle="pill" data-bs-target="#payslips" type="button">
                                    <i class="bi bi-file-earmark-text"></i> Payslips
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="clients-tab" data-bs-toggle="pill" data-bs-target="#clients" type="button">
                                    <i class="bi bi-people"></i> Clients
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="jobs-tab" data-bs-toggle="pill" data-bs-target="#jobs" type="button">
                                    <i class="bi bi-list-check"></i> Job Types
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="search-tab" data-bs-toggle="pill" data-bs-target="#search" type="button">
                                    <i class="bi bi-search"></i> Search
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="reports-tab" data-bs-toggle="pill" data-bs-target="#reports" type="button">
                                    <i class="bi bi-file-earmark-bar-graph"></i> Reports
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="analytics-tab" data-bs-toggle="pill" data-bs-target="#analytics" type="button">
                                    <i class="bi bi-graph-up-arrow"></i> Analytics
                                </button>
                            </li>
                            <li class="nav-item" role="presentation">
                                <button class="nav-link" id="settings-tab" data-bs-toggle="pill" data-bs-target="#settings" type="button">
                                    <i class="bi bi-gear"></i> Settings
                                </button>
                            </li>
                        </ul>

                        <div class="tab-content" id="mainTabContent">
                            <!-- Dashboard Tab -->
                            <div class="tab-pane fade show active" id="dashboard" role="tabpanel">
                                <div class="row g-4">
                                    <div class="col-lg-8">
                                        <div class="d-flex justify-content-between align-items-center mb-3">
                                            <h5 class="section-title mb-0">Weekly Earnings Trend</h5>
                                            <select class="form-select form-select-sm" id="trendYearFilter" style="width: auto;" onchange="updateWeeklyTrend()">
                                                <!-- Years will be populated here -->
                                            </select>
                                        </div>
                                        <div class="chart-container">
                                            <canvas id="weeklyChart"></canvas>
                                        </div>
                                    </div>
                                    <div class="col-lg-4">
                                        <h5 class="section-title">Current Tax Year</h5>
                                        <div class="card border-0 bg-light">
                                            <div class="card-body">
                                                <h6 class="text-muted">Tax Year <span id="currentTaxYear"></span></h6>
                                                <hr>
                                                <div class="d-flex justify-content-between mb-2">
                                                    <span>Weeks Worked:</span>
                                                    <strong id="currentYearWeeks">0</strong>
                                                </div>
                                                <div class="d-flex justify-content-between mb-2">
                                                    <span>Total Earned:</span>
                                                    <strong id="currentYearTotal">£0.00</strong>
                                                </div>
                                                <div class="d-flex justify-content-between mb-2">
                                                    <span>Average/Week:</span>
                                                    <strong id="currentYearAvg">£0.00</strong>
                                                </div>
                                                <hr>
                                                <div class="d-flex justify-content-between">
                                                    <span>Last 4 Weeks Avg:</span>
                                                    <strong class="text-primary" id="last4WeeksAvg">£0.00</strong>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <h5 class="section-title mt-4">Top Clients</h5>
                                        <div id="topClientsList"></div>
                                    </div>
                                </div>
                            </div>

                            <!-- Payslips Tab -->
                            <div class="tab-pane fade" id="payslips" role="tabpanel">
                                <div class="d-flex justify-content-between align-items-center mb-3">
                                    <h5 class="section-title mb-0">All Payslips</h5>
                                    <select class="form-select w-auto" id="taxYearFilter">
                                        <option value="">All Years</option>
                                    </select>
                                </div>
                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead class="table-light">
                                            <tr>
                                                <th>Tax Year</th>
                                                <th>Week</th>
                                                <th class="hide-mobile">Pay Date</th>
                                                <th>Net Payment</th>
                                                <th class="hide-mobile">Jobs</th>
                                                <th>Action</th>
                                            </tr>
                                        </thead>
                                        <tbody id="payslipsTable">
                                            <tr>
                                                <td colspan="6" class="text-center">
                                                    <div class="spinner-border text-primary" role="status">
                                                        <span class="visually-hidden">Loading...</span>
                                                    </div>
                                                </td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>
                            </div>

                            <!-- Clients Tab -->
                            <div class="tab-pane fade" id="clients" role="tabpanel">
                                <h5 class="section-title">Client Breakdown</h5>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="chart-container">
                                            <canvas id="clientsChart"></canvas>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="table-responsive">
                                            <table class="table table-hover">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th>Client</th>
                                                        <th class="hide-mobile">Jobs</th>
                                                        <th>Total</th>
                                                        <th class="hide-mobile">Avg</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="clientsTable"></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Job Types Tab -->
                            <div class="tab-pane fade" id="jobs" role="tabpanel">
                                <h5 class="section-title">Job Type Analysis</h5>
                                <div class="row">
                                    <div class="col-lg-6">
                                        <div class="chart-container">
                                            <canvas id="jobTypesChart"></canvas>
                                        </div>
                                    </div>
                                    <div class="col-lg-6">
                                        <div class="table-responsive">
                                            <table class="table table-hover">
                                                <thead class="table-light">
                                                    <tr>
                                                        <th>Job Type</th>
                                                        <th class="hide-mobile">Count</th>
                                                        <th>Total</th>
                                                        <th class="hide-mobile">Avg</th>
                                                    </tr>
                                                </thead>
                                                <tbody id="jobTypesTable"></tbody>
                                            </table>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Search Tab -->
                            <div class="tab-pane fade" id="search" role="tabpanel">
                                <h5 class="section-title">Search Jobs</h5>
                                <div class="mb-4">
                                    <input type="text" class="form-control search-box" id="searchInput" 
                                           placeholder="Search by client, location, or description...">
                                </div>
                                <div id="searchResults"></div>
                            </div>

                            <!-- Reports Tab -->
                            <div class="tab-pane fade" id="reports" role="tabpanel">
                                <h5 class="section-title">Generate Reports</h5>
                                
                                <div class="row g-4">
                                    <!-- Date Range Report -->
                                    <div class="col-md-6">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-body">
                                                <h6 class="card-title">
                                                    <i class="bi bi-calendar-range text-primary"></i>
                                                    Date Range Report
                                                </h6>
                                                <p class="text-muted small">Generate earnings report for a specific period</p>
                                                <div class="mb-3">
                                                    <label class="form-label small">Tax Year</label>
                                                    <select class="form-select" id="reportTaxYear">
                                                        <option value="">All Years</option>
                                                    </select>
                                                </div>
                                                <button class="btn btn-primary w-100" onclick="generateDateRangeReport()">
                                                    <i class="bi bi-file-earmark-text"></i> Generate Report
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Client Report -->
                                    <div class="col-md-6">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-body">
                                                <h6 class="card-title">
                                                    <i class="bi bi-people text-success"></i>
                                                    Client Analysis Report
                                                </h6>
                                                <p class="text-muted small">Detailed breakdown by client</p>
                                                <div class="mb-3">
                                                    <label class="form-label small">Top Clients</label>
                                                    <select class="form-select" id="reportClientLimit">
                                                        <option value="10">Top 10</option>
                                                        <option value="20">Top 20</option>
                                                        <option value="50">Top 50</option>
                                                        <option value="all">All Clients</option>
                                                    </select>
                                                </div>
                                                <button class="btn btn-success w-100" onclick="generateClientReport()">
                                                    <i class="bi bi-file-earmark-bar-graph"></i> Generate Report
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Job Type Report -->
                                    <div class="col-md-6">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-body">
                                                <h6 class="card-title">
                                                    <i class="bi bi-briefcase text-info"></i>
                                                    Job Type Report
                                                </h6>
                                                <p class="text-muted small">Analysis by job type and category</p>
                                                <div class="mb-3">
                                                    <label class="form-label small">Include</label>
                                                    <select class="form-select" id="reportJobTypeLimit">
                                                        <option value="10">Top 10</option>
                                                        <option value="20">Top 20</option>
                                                        <option value="all">All Types</option>
                                                    </select>
                                                </div>
                                                <button class="btn btn-info w-100" onclick="generateJobTypeReport()">
                                                    <i class="bi bi-file-earmark-spreadsheet"></i> Generate Report
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Monthly Summary -->
                                    <div class="col-md-6">
                                        <div class="card border-0 shadow-sm">
                                            <div class="card-body">
                                                <h6 class="card-title">
                                                    <i class="bi bi-calendar3 text-warning"></i>
                                                    Monthly Summary
                                                </h6>
                                                <p class="text-muted small">Month-by-month earnings breakdown</p>
                                                <div class="mb-3">
                                                    <label class="form-label small">Tax Year</label>
                                                    <select class="form-select" id="reportMonthlyYear">
                                                        <option value="">All Years</option>
                                                    </select>
                                                </div>
                                                <button class="btn btn-warning w-100" onclick="generateMonthlyReport()">
                                                    <i class="bi bi-file-earmark-ruled"></i> Generate Report
                                                </button>
                                            </div>
                                        </div>
                                    </div>

                                    <!-- Custom Filter Report -->
                                    <div class="col-md-12">
                                        <div class="card border-0 shadow-sm bg-light">
                                            <div class="card-body">
                                                <h6 class="card-title">
                                                    <i class="bi bi-funnel text-danger"></i>
                                                    Custom Filtered Report
                                                </h6>
                                                <p class="text-muted small">Filter jobs by multiple criteria</p>
                                                
                                                <div class="form-check form-switch mb-3">
                                                    <input class="form-check-input" type="checkbox" id="useGroupings" checked>
                                                    <label class="form-check-label" for="useGroupings">
                                                        <strong>Use Groupings</strong> - Show group names instead of individual items
                                                    </label>
                                                </div>
                                                
                                                <div class="row g-3">
                                                    <div class="col-md-3">
                                                        <label class="form-label small">Tax Year</label>
                                                        <select class="form-select form-select-sm" id="customTaxYear">
                                                            <option value="">All Years</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <label class="form-label small">Week From</label>
                                                        <input type="number" class="form-control form-control-sm" id="customWeekFrom" 
                                                               placeholder="1" min="1" max="52">
                                                    </div>
                                                    <div class="col-md-2">
                                                        <label class="form-label small">Week To</label>
                                                        <input type="number" class="form-control form-control-sm" id="customWeekTo" 
                                                               placeholder="52" min="1" max="52">
                                                    </div>
                                                    <div class="col-md-3">
                                                        <label class="form-label small">Client / Group</label>
                                                        <select class="form-select form-select-sm" id="customClient">
                                                            <option value="">All Clients</option>
                                                        </select>
                                                    </div>
                                                    <div class="col-md-2">
                                                        <label class="form-label small">Job Type / Group</label>
                                                        <select class="form-select form-select-sm" id="customJobType">
                                                            <option value="">All Types</option>
                                                        </select>
                                                    </div>
                                                </div>
                                                
                                                <div class="mt-3">
                                                    <button class="btn btn-danger" onclick="generateCustomReport()">
                                                        <i class="bi bi-funnel-fill"></i> Generate Custom Report
                                                    </button>
                                                    <button class="btn btn-outline-secondary" onclick="clearCustomFilters()">
                                                        <i class="bi bi-x-circle"></i> Clear Filters
                                                    </button>
                                                    <button class="btn btn-outline-info" onclick="refreshCustomFilters()">
                                                        <i class="bi bi-arrow-clockwise"></i> Refresh Lists
                                                    </button>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Report Output Area -->
                                <div class="mt-4" id="reportOutput" style="display: none;">
                                    <div class="card border-0 shadow-sm">
                                        <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                            <h6 class="mb-0">
                                                <i class="bi bi-file-text"></i>
                                                <span id="reportTitle">Report</span>
                                            </h6>
                                            <div>
                                                <button class="btn btn-sm btn-outline-danger me-2" onclick="downloadReportPDF()">
                                                    <i class="bi bi-file-pdf"></i> PDF
                                                </button>
                                                <button class="btn btn-sm btn-outline-success me-2" onclick="downloadReportCSV()">
                                                    <i class="bi bi-download"></i> CSV
                                                </button>
                                                <button class="btn btn-sm btn-outline-primary" onclick="printReport()">
                                                    <i class="bi bi-printer"></i> Print
                                                </button>
                                            </div>
                                        </div>
                                        <div class="card-body" id="reportContent">
                                            <!-- Report content will be inserted here -->
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Analytics Tab -->
                            <div class="tab-pane fade" id="analytics" role="tabpanel">
                                <h4 class="mb-4"><i class="bi bi-graph-up-arrow text-primary"></i> Advanced Analytics</h4>
                                
                                <!-- Year-over-Year Comparison -->
                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-header bg-white">
                                        <h5 class="mb-0"><i class="bi bi-bar-chart-line text-primary"></i> Year-over-Year Comparison</h5>
                                    </div>
                                    <div class="card-body">
                                        <p class="text-muted small">Compare weekly earnings across different tax years</p>
                                        <div class="chart-container" style="height: 400px;">
                                            <canvas id="yearComparisonChart"></canvas>
                                        </div>
                                    </div>
                                </div>

                                <!-- Earnings Forecast -->
                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-header bg-white">
                                        <h5 class="mb-0"><i class="bi bi-graph-up text-success"></i> Earnings Forecast</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-md-8">
                                                <p class="text-muted small">Predicted earnings for the remainder of the current tax year</p>
                                                <div class="chart-container" style="height: 350px;">
                                                    <canvas id="forecastChart"></canvas>
                                                </div>
                                            </div>
                                            <div class="col-md-4">
                                                <div class="card bg-light border-0">
                                                    <div class="card-body">
                                                        <h6 class="text-muted">Forecast Summary</h6>
                                                        <hr>
                                                        <div class="mb-3">
                                                            <small class="text-muted">Current Year</small>
                                                            <h5 id="forecastYear" class="mb-0">-</h5>
                                                        </div>
                                                        <div class="mb-3">
                                                            <small class="text-muted">Weeks Worked</small>
                                                            <h5 id="forecastWeeksWorked" class="mb-0">-</h5>
                                                        </div>
                                                        <div class="mb-3">
                                                            <small class="text-muted">Total Earned</small>
                                                            <h5 id="forecastTotalEarned" class="mb-0">£0.00</h5>
                                                        </div>
                                                        <div class="mb-3">
                                                            <small class="text-muted">Trend</small>
                                                            <h5 id="forecastTrend" class="mb-0">
                                                                <span class="badge bg-secondary">-</span>
                                                            </h5>
                                                        </div>
                                                        <hr>
                                                        <div class="mb-0">
                                                            <small class="text-muted">Projected Year-End</small>
                                                            <h4 id="forecastProjected" class="mb-0 text-primary">£0.00</h4>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Client Activity Heatmap -->
                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-header bg-white d-flex justify-content-between align-items-center">
                                        <h5 class="mb-0"><i class="bi bi-calendar-heat text-warning"></i> Client Activity Heatmap</h5>
                                        <select class="form-select w-auto" id="heatmapYearFilter" onchange="loadClientHeatmap(this.value)">
                                            <option value="">All Years</option>
                                        </select>
                                    </div>
                                    <div class="card-body">
                                        <p class="text-muted small">Visualize which clients are most active by month</p>
                                        <div id="heatmapContainer" style="overflow-x: auto;">
                                            <div class="text-center py-5">
                                                <div class="spinner-border text-primary" role="status"></div>
                                                <p class="text-muted mt-2">Loading heatmap...</p>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <!-- Weekly Performance Analysis -->
                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-header bg-white">
                                        <h5 class="mb-0"><i class="bi bi-trophy text-danger"></i> Weekly Performance Analysis</h5>
                                    </div>
                                    <div class="card-body">
                                        <p class="text-muted small">Compare your best and worst performing weeks</p>
                                        <div class="row">
                                            <!-- Best Weeks -->
                                            <div class="col-md-6">
                                                <h6 class="text-success mb-3">
                                                    <i class="bi bi-arrow-up-circle-fill"></i> Top 10 Best Weeks
                                                </h6>
                                                <div class="table-responsive">
                                                    <table class="table table-sm table-hover">
                                                        <thead class="table-light">
                                                            <tr>
                                                                <th>Rank</th>
                                                                <th>Week</th>
                                                                <th>Amount</th>
                                                                <th>Jobs</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="bestWeeksTable">
                                                            <tr>
                                                                <td colspan="4" class="text-center">
                                                                    <div class="spinner-border spinner-border-sm text-primary"></div>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                            
                                            <!-- Worst Weeks -->
                                            <div class="col-md-6">
                                                <h6 class="text-danger mb-3">
                                                    <i class="bi bi-arrow-down-circle-fill"></i> Top 10 Lowest Weeks
                                                </h6>
                                                <div class="table-responsive">
                                                    <table class="table table-sm table-hover">
                                                        <thead class="table-light">
                                                            <tr>
                                                                <th>Rank</th>
                                                                <th>Week</th>
                                                                <th>Amount</th>
                                                                <th>Jobs</th>
                                                            </tr>
                                                        </thead>
                                                        <tbody id="worstWeeksTable">
                                                            <tr>
                                                                <td colspan="4" class="text-center">
                                                                    <div class="spinner-border spinner-border-sm text-primary"></div>
                                                                </td>
                                                            </tr>
                                                        </tbody>
                                                    </table>
                                                </div>
                                            </div>
                                        </div>
                                        
                                        <div class="alert alert-info mt-3">
                                            <strong><i class="bi bi-info-circle"></i> Average Weekly Earnings:</strong>
                                            <span id="avgWeeklyEarnings" class="float-end">£0.00</span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <!-- Settings Tab -->
                            <div class="tab-pane fade" id="settings" role="tabpanel">
                                
                                <!-- Page Header -->
                                <div class="d-flex justify-content-between align-items-center mb-4">
                                    <div>
                                        <h4 class="mb-1"><i class="bi bi-gear-fill text-primary"></i> Settings & Maintenance</h4>
                                        <p class="text-muted small mb-0">Manage your payslips, data, and groupings</p>
                                    </div>
                                </div>
                                
                                <!-- Data Management Section -->
                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-header bg-white border-bottom">
                                        <h5 class="mb-0"><i class="bi bi-database-fill-gear text-danger"></i> Data Management</h5>
                                    </div>
                                    <div class="card-body">
                                        <div class="row g-3">
                                            <!-- Upload Payslips -->
                                            <div class="col-md-4">
                                                <div class="border rounded p-3 h-100 bg-light">
                                                    <h6 class="text-success mb-2">
                                                        <i class="bi bi-cloud-upload-fill"></i> Upload Payslips
                                                    </h6>
                                                    <p class="text-muted small mb-3">Upload PDF payslips to process</p>
                                                    
                                                    <div class="mb-2">
                                                        <select class="form-select form-select-sm" id="uploadTaxYear">
                                                            <option>Loading...</option>
                                                        </select>
                                                    </div>
                                                    
                                                    <div class="mb-2">
                                                        <input type="file" class="form-control form-control-sm" id="payslipFiles" 
                                                               accept=".pdf" multiple>
                                                    </div>
                                                    
                                                    <button class="btn btn-success btn-sm w-100" onclick="uploadPayslips()">
                                                        <i class="bi bi-upload"></i> Upload & Process
                                                    </button>
                                                    
                                                    <div id="uploadStatus" class="mt-3" style="display: none;">
                                                        <div class="progress" style="height: 5px;">
                                                            <div class="progress-bar progress-bar-striped progress-bar-animated bg-success" 
                                                                 role="progressbar" style="width: 100%"></div>
                                                        </div>
                                                        <p class="text-muted small mt-2 mb-0" id="uploadMessage">Uploading...</p>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Process Payslips -->
                                            <div class="col-md-4">
                                                <div class="border rounded p-3 h-100">
                                                    <h6 class="text-danger mb-2">
                                                        <i class="bi bi-file-earmark-pdf-fill"></i> Reprocess All
                                                    </h6>
                                                    <p class="text-muted small mb-3">Re-extract data from all existing PDFs</p>
                                                    
                                                    <button class="btn btn-danger btn-sm w-100 mt-4" onclick="processPayslips()">
                                                        <i class="bi bi-gear-fill"></i> Process All PDFs
                                                    </button>
                                                    
                                                    <div id="processingStatus" class="mt-3" style="display: none;">
                                                        <div class="progress" style="height: 5px;">
                                                            <div class="progress-bar progress-bar-striped progress-bar-animated bg-danger" 
                                                                 role="progressbar" style="width: 100%"></div>
                                                        </div>
                                                        <p class="text-muted small mt-2 mb-0" id="processingMessage">Processing...</p>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Check Missing -->
                                            <div class="col-md-4">
                                                <div class="border rounded p-3 h-100">
                                                    <h6 class="text-warning mb-2">
                                                        <i class="bi bi-exclamation-triangle-fill"></i> Check Missing
                                                    </h6>
                                                    <p class="text-muted small mb-3">Verify all payslip weeks are present</p>
                                                    
                                                    <button class="btn btn-warning btn-sm w-100 mt-4" onclick="checkMissingPayslips()">
                                                        <i class="bi bi-search"></i> Check for Gaps
                                                    </button>
                                                    
                                                    <div id="missingResults" class="mt-3" style="display: none;">
                                                        <!-- Results will be shown here -->
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Database Management Section -->
                                <div class="card border-0 shadow-sm mb-4">
                                    <div class="card-header bg-white border-bottom">
                                        <h5 class="mb-0"><i class="bi bi-database text-info"></i> Database Management</h5>
                                    </div>
                                    <div class="card-body">
                                        <p class="text-muted small mb-3">
                                            <i class="bi bi-info-circle"></i>
                                            Backup your data before clearing or for safekeeping
                                        </p>
                                        
                                        <div class="row g-3">
                                            <!-- Backup Database -->
                                            <div class="col-md-6">
                                                <div class="border rounded p-3">
                                                    <h6 class="text-info mb-2">
                                                        <i class="bi bi-download"></i> Backup Database
                                                    </h6>
                                                    <p class="text-muted small mb-3">Download a copy of your database</p>
                                                    
                                                    <button class="btn btn-info btn-sm w-100" onclick="backupDatabase()">
                                                        <i class="bi bi-download"></i> Download Backup
                                                    </button>
                                                </div>
                                            </div>
                                            
                                            <!-- Clear Database -->
                                            <div class="col-md-6">
                                                <div class="border rounded p-3">
                                                    <h6 class="text-danger mb-2">
                                                        <i class="bi bi-trash"></i> Clear All Data
                                                    </h6>
                                                    <p class="text-muted small mb-3">Delete all payslips and start fresh</p>
                                                    
                                                    <button class="btn btn-danger btn-sm w-100" onclick="clearDatabase()">
                                                        <i class="bi bi-trash"></i> Clear Database
                                                    </button>
                                                    
                                                    <div id="clearStatus" class="mt-2" style="display: none;">
                                                        <p class="text-muted small mb-0" id="clearMessage"></p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                
                                <!-- Groupings Section -->
                                <div class="card border-0 shadow-sm">
                                    <div class="card-header bg-white border-bottom">
                                        <h5 class="mb-0"><i class="bi bi-collection-fill text-primary"></i> Report Groupings</h5>
                                    </div>
                                    <div class="card-body">
                                        <p class="text-muted small mb-3">
                                            <i class="bi bi-info-circle"></i>
                                            Create groups to combine multiple clients or job types in your reports
                                        </p>
                                
                                        <div class="row g-3">
                                            <!-- Client Groupings -->
                                            <div class="col-md-6">
                                                <div class="border rounded p-3">
                                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                                        <h6 class="mb-0 text-primary">
                                                            <i class="bi bi-people-fill"></i> Client Groups
                                                        </h6>
                                                        <button class="btn btn-sm btn-outline-primary" onclick="showClientGroupModal()">
                                                            <i class="bi bi-plus-circle"></i> New
                                                        </button>
                                                    </div>
                                                    <div id="clientGroupsList" style="max-height: 300px; overflow-y: auto;">
                                                        <p class="text-muted small mb-0">Loading...</p>
                                                    </div>
                                                </div>
                                            </div>
                                            
                                            <!-- Job Type Groupings -->
                                            <div class="col-md-6">
                                                <div class="border rounded p-3">
                                                    <div class="d-flex justify-content-between align-items-center mb-3">
                                                        <h6 class="mb-0 text-success">
                                                            <i class="bi bi-briefcase-fill"></i> Job Type Groups
                                                        </h6>
                                                        <button class="btn btn-sm btn-outline-success" onclick="showJobTypeGroupModal()">
                                                            <i class="bi bi-plus-circle"></i> New
                                                        </button>
                                                    </div>
                                                    <div id="jobTypeGroupsList" style="max-height: 300px; overflow-y: auto;">
                                                        <p class="text-muted small mb-0">Loading...</p>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Payslip Detail Modal -->
    <div class="modal fade" id="payslipModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-gradient-primary text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-file-earmark-text"></i>
                        Payslip Detail
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body" id="payslipModalBody">
                    <div class="text-center">
                        <div class="spinner-border text-primary" role="status">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Client Group Modal -->
    <div class="modal fade" id="clientGroupModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-gradient-primary text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-people-fill"></i>
                        Create Client Group
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Group Name</label>
                        <input type="text" class="form-control" id="clientGroupName" 
                               placeholder="e.g., Fujitsu All, Computacenter All">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Search Clients</label>
                        <input type="text" class="form-control" id="clientSearchBox" 
                               placeholder="Type to filter clients...">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Select Clients to Group</label>
                        <div id="clientCheckboxList" style="max-height: 300px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 5px; padding: 10px;">
                            <div class="text-center">
                                <div class="spinner-border text-primary" role="status"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-secondary small">
                        <strong>Selected:</strong> <span id="clientSelectedCount">0</span> clients
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-primary" onclick="saveClientGroup()">
                        <i class="bi bi-save"></i> Create Group
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Job Type Group Modal -->
    <div class="modal fade" id="jobTypeGroupModal" tabindex="-1">
        <div class="modal-dialog modal-lg">
            <div class="modal-content">
                <div class="modal-header bg-gradient-success text-white">
                    <h5 class="modal-title">
                        <i class="bi bi-briefcase-fill"></i>
                        Create Job Type Group
                    </h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <div class="mb-3">
                        <label class="form-label">Group Name</label>
                        <input type="text" class="form-control" id="jobTypeGroupName" 
                               placeholder="e.g., Tech Exchange All, Repairs All">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Search Job Types</label>
                        <input type="text" class="form-control" id="jobTypeSearchBox" 
                               placeholder="Type to filter job types...">
                    </div>
                    
                    <div class="mb-3">
                        <label class="form-label">Select Job Types to Group</label>
                        <div id="jobTypeCheckboxList" style="max-height: 300px; overflow-y: auto; border: 1px solid #dee2e6; border-radius: 5px; padding: 10px;">
                            <div class="text-center">
                                <div class="spinner-border text-success" role="status"></div>
                            </div>
                        </div>
                    </div>
                    
                    <div class="alert alert-secondary small">
                        <strong>Selected:</strong> <span id="jobTypeSelectedCount">0</span> job types
                    </div>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                    <button type="button" class="btn btn-success" onclick="saveJobTypeGroup()">
                        <i class="bi bi-save"></i> Create Group
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- Bootstrap JS -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    
    <!-- jsPDF for PDF export -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    
    <!-- Custom JS -->
    <script src="{{ url_for('static', filename='js/app.js') }}"></script>
    <script src="{{ url_for('static', filename='js/analytics.js') }}"></script>
</body>
</html>
